on:
  push:
    tags:
      - "v*"

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # Build binaries for all platforms
      - name: Build Tortie Chain binaries
        run: |
          mkdir -p release

          # Linux amd64
          GOOS=linux  GOARCH=amd64 \
            go build -o release/tortied-linux-amd64 ./cmd/tortied

          # macOS ARM (M1/M2/M3)
          GOOS=darwin GOARCH=arm64 \
            go build -o release/tortied-darwin-arm64 ./cmd/tortied

          # macOS Intel
          GOOS=darwin GOARCH=amd64 \
            go build -o release/tortied-darwin-amd64 ./cmd/tortied

      # Create the GitHub Release + upload files
      - name: Publish Release
        uses: softprops/action-gh-release@v1
        with:
          files: release/*
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
