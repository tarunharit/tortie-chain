on:
  push:
    tags:
      - "v*"

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # Build binaries for all platforms
      - name: Build Tortie Chain binaries
        run: |
          mkdir -p release
          GOOS=linux  GOARCH=amd64  go build -o release/tortie-chaind-linux-amd64  ./cmd/tortie-chaind
          GOOS=darwin GOARCH=arm64  go build -o release/tortie-chaind-darwin-arm64 ./cmd/tortie-chaind
          GOOS=darwin GOARCH=amd64 go build -o release/tortie-chaind-darwin-amd64 ./cmd/tortie-chaind

      # Create the GitHub Release + upload files
      - name: Publish Release
        uses: softprops/action-gh-release@v1
        with:
          files: release/*
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
